#!/bin/bash

# ะกะบัะธะฟั ัะตััะธัะพะฒะฐะฝะธั I2P Daemon GUI
# ะะฒัะพั: I2P Community
# ะะตััะธั: 1.0.0

set -e

echo "๐งช ะะฐะฟััะบ ัะตััะพะฒ I2P Daemon GUI..."

# ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต Node.js
if ! command -v node &> /dev/null; then
    echo "โ Node.js ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต Node.js 16+ ะธ ะฟะพะฟัะพะฑัะนัะต ัะฝะพะฒะฐ."
    exit 1
fi

echo "โ Node.js ะฒะตััะธั: $(node -v)"

# ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ ะตัะปะธ ะฝัะถะฝะพ
if [ ! -d "node_modules" ]; then
    echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ..."
    npm install
fi

# ะะฐะฟััะบะฐะตะผ ัะตััั React
echo "๐ฌ ะะฐะฟััะบะฐะตะผ ัะตััั React..."
npm test -- --coverage --watchAll=false

# ะัะพะฒะตััะตะผ ะปะธะฝัะตั
echo "๐ ะัะพะฒะตััะตะผ ะบะพะด ะปะธะฝัะตัะพะผ..."
npm run lint 2>/dev/null || echo "โ๏ธ  ะะธะฝัะตั ะฝะต ะฝะฐัััะพะตะฝ"

# ะัะพะฒะตััะตะผ ัะธะฟั TypeScript (ะตัะปะธ ะธัะฟะพะปัะทัะตััั)
if [ -f "tsconfig.json" ]; then
    echo "๐ ะัะพะฒะตััะตะผ ัะธะฟั TypeScript..."
    npx tsc --noEmit 2>/dev/null || echo "โ๏ธ  TypeScript ะฟัะพะฒะตัะบะฐ ะฝะต ะฟัะพัะปะฐ"
fi

# ะัะพะฒะตััะตะผ ัะฑะพัะบั
echo "๐จ ะัะพะฒะตััะตะผ ัะฑะพัะบั..."
npm run build

if [ -d "build" ]; then
    echo "โ ะกะฑะพัะบะฐ ะฟัะพัะปะฐ ััะฟะตัะฝะพ"
else
    echo "โ ะัะธะฑะบะฐ ัะฑะพัะบะธ"
    exit 1
fi

# ะัะพะฒะตััะตะผ Electron ัะฑะพัะบั
echo "โก ะัะพะฒะตััะตะผ Electron ัะฑะพัะบั..."
npm run electron-pack

# ะัะพะฒะตััะตะผ ัะฐะทะผะตั ัะฑะพัะบะธ
echo "๐ ะะฐะทะผะตั ัะฑะพัะบะธ:"
du -sh build/ 2>/dev/null || echo "ะะต ัะดะฐะปะพัั ะพะฟัะตะดะตะปะธัั ัะฐะทะผะตั"

echo ""
echo "โ ะัะต ัะตััั ะฟัะพะนะดะตะฝั ััะฟะตัะฝะพ!"
echo "๐ ะะตะทัะปััะฐัั:"
echo "   - React ัะตััั: โ"
echo "   - ะกะฑะพัะบะฐ: โ"
echo "   - Electron: โ"
echo ""
echo "๐ ะะพัะพะฒะพ ะบ ัะฐะทะฒะตัััะฒะฐะฝะธั!"

